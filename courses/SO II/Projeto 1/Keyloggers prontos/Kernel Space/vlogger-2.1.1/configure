#!/bin/sh
#
# Copyright (C) 2002-2003 rd <rd@thc.org>
#

# get user input data
getdata() {
	local myvar="$1"
	shift
	# print out the message
	echo -en "$@"
	read data
	if [ ! -z "$data" ] ; then
		eval $myvar="$data"
	fi
	echo
}

clear
head -10 README
echo
cat NOTICE
echo

if [ ! -z "`sed -ne '/kernel_thread_R.*/p'</proc/ksyms`" ]; then
	MODVER_FLAGS="-DMODVERSIONS -include \$\(MODVER_FILE\)"
fi 

KERNELDIR=/lib/modules/`uname -r`/build
getdata KERNELDIR "Where is the linux source build directory [$KERNELDIR]: "

# Update Makefile and make
echo "Generating Makefile"
sed -e 	"s#KERNELDIR = \(.*\)#KERNELDIR = $KERNELDIR#; \
        s#MODVER_FLAGS = \(.*\)#MODVER_FLAGS = $MODVER_FLAGS#;" \
        > ./Makefile < ./Makefile.gen || exit $?

